---
- name: deploy pki 2
  hosts: pki
  become: true
  gather_facts: yes
  tasks: 
   - name: install packages
     apt:
       name: ['default-jdk-headless', 'ant', 'ant-optional', 'unzip','mariadb-server','postfix','s-nail'] 
       state: present
       
   - name: create pki user
     user:
       name: pki

   - name: copy mysql utf8 config
     copy:
       src: mysql/utf-8.conf
       dest: /etc/mysql/conf.d/utf-8.conf
       
   - name: restart mysql service
     service:
       name: mysql
       state: restarted
   
   - name: init database
     command:
       cmd: mysql -e "CREATE DATABASE ejbca CHARACTER SET utf8 COLLATE utf8_general_ci; grant all privileges on ejbca.* to 'ejbca'@'localhost' identified by 'lemotdepasse'; flush privileges;"
       
   - name: copy wildfly
     copy:
       src: wildfly/wildfly-30.0.0.Final/
       dest: /opt/pki/wildfly
       
       